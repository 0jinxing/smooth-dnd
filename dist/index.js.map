{"version":3,"sources":["webpack://SmoothDND/webpack/universalModuleDefinition","webpack://SmoothDND/webpack/bootstrap","webpack://SmoothDND/./src/constants.js","webpack://SmoothDND/./src/utils.js","webpack://SmoothDND/./src/dropHandlers.js","webpack://SmoothDND/./src/styles.js","webpack://SmoothDND/./src/mediator.js","webpack://SmoothDND/./src/layoutManager.js","webpack://SmoothDND/./src/dragscroller.js","webpack://SmoothDND/./src/container.js","webpack://SmoothDND/./index.js"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","r","value","n","__esModule","object","property","prototype","hasOwnProperty","p","s","containerInstance","containersInDraggable","defaultGroupName","wrapperClass","defaultGrabHandleClass","animationClass","translationValue","visibilityValue","ghostClass","containerClass","extraSizeForInsertion","stretcherElementClass","stretcherElementInstance","isDraggableDetached","disbaleTouchActions","noUserSelectClass","getIntersection","rect1","rect2","left","Math","max","top","right","min","bottom","getIntersectionOnAxis","axis","getContainerRect","element","_rect","getBoundingClientRect","rect","hasBiggerChild","isScrollingOrHidden","width","scrollWidth","height","scrollHeight","isScrolling","style","getComputedStyle","overflow","overFlowAxis","clientWidth","clientHeight","hasScrollBar","getVisibleRect","elementRect","currentElement","parentElement","listenScrollParent","clb","scrollers","setTimeout","addEventListener","push","dispose","forEach","removeEventListener","hasParent","parent","current","getParent","selector","matches","hasClass","cls","className","split","map","indexOf","addClass","classes","filter","join","removeClass","debounce","fn","delay","immediate","timer","_len","arguments","length","params","Array","_key","clearTimeout","apply","undefined","concat","removeChildAt","index","removeChild","children","addChildAt","child","lenght","appendChild","insertBefore","isMobile","navigator","userAgent","match","domDropHandler","_ref","draggables","options","layout","dropResult","onDrop","removedIndex","addedIndex","droppedElement","removedWrapper","_utils","splice","wrapper","document","createElement","_constants","orientation","firstChild","reactDropHandler","handler","_ref2","constants","css","position","_defineProperty","_css","box-sizing","white-space","display","transition","touch-actions","-ms-touch-actions","addStyleToHead","head","getElementsByTagName","cssString","convertToCssString","entries","reduce","styleString","_slicedToArray","propName","propValue","_typeof","type","styleSheet","cssText","createTextNode","Utils","_styles","grabEvents","moveEvents","releaseEvents","dragListeningContainers","grabbedElement","ghostInfo","draggableInfo","containers","isDragging","listenEvents","e","onMouseDown","passive","handleDragStartConditions","startEvent","moveThreshold","maxMoveInDelay","onMove","event","_getPointerEvent","getPointerEvent","currentX","clientX","currentY","clientY","abs","deregisterEvent","callCallback","onUp","onHTMLDrag","_startEvent","_delay","_clb","target","containerElement","container","dragHandleSelector","getOptions","nonDragAreaSelector","startDrag","preventDefault","dragBeginDelay","getSelection","empty","initiateDrag","onMouseMove","onMouseUp","callback","endDrop","ghost","transitionDuration","body","animateGhostToPosition","duration","targetElement","shouldAnimateDrop","getDragResult","shadowBeginEnd","animationDuration","behaviour","_container$getDragRes","elementSize","getTranslateCalculator","dragResult","prevDraggableEnd","getBeginEnd","end","getBeginEndOfContainer","begin","getTopLeftOfElementBegin","opacity","transform","handleDropAnimation","touchAction","handleDrop","touches","setDraggables","draggableElement","draggableIndex","elementIndex","payload","getChildPayload","x","y","groupName","getDraggableInfo","_container$getScale","getScale","_container$getScale$s","scaleX","_container$getScale$s2","scaleY","_element$getBoundingC","midX","midY","div","pointerEvents","clone","cloneNode","dragClass","childNodes","transformOrigin","margin","centerDelta","positionDelta","getGhostElement","isDragRelevant","prepareDrag","handleDrag","register","unregister","_animationDuration","propMapper","obj","prop","mappedProp","set","requestAnimationFrame","setters","orientationDependentProps","horizontalMap","verticalMap","values","translation","registeredScrollListener","invalidateContainerRectangles","invalidate","scrollListener","offsetWidth","offsetHeight","invalidateContainerScale","visibleRect","getSize","getAxisValue","getTranslation","isInVisibleRect","_values$visibleRect","getContainerRectangles","getBeginEndOfDOMRect","getBeginEndOfContainerVisibleRect","getDistanceToOffsetParent","setTranslation","removeProperty","updateDescendantContainerRects","invalidateRects","onTranslated","getChildContainers","setVisibility","isVisible","visibility","parentNode","getContainerScale","setScrollListener","setSize","size","getScrollSize","getScrollValue","setScrollValue","val","getPosition","distanceToParent","translate","dragPosition","scrollSize","offsetSize","scrollValue","scale","getScrollableParent","requestFrame","isAnimating","request","startTime","direction","speed","animate","_direction","_speed","start","timestamp","timeDiff","distanceDiff","scrollTo","stop","cancelAnimationFrame","lastPos","scrollableParent","scrollParentBeginEnd","animator","pos","scrollableBeginEnd","reset","autoScrollEnabled","autoScrollInfo","speedFactor","containerIniter","lastDraggableInfo","props","initialOptions","defaultOptions","result","assign","acceptGroups","initOptions","wrapChildren","_layoutManager2","default","getContainerProps","dragHandler","getDragHandler","dropHandler","_ref4","draggablesReset","_ref3","setAnimation","resetDraggables","_dropHandlers","_ref5","actualAddIndex","dropHandlerParams","console","log","handleScrollOnDrag","_dragscroller2","parentContainer","posIsInChildContainer","childContainers","processLastDraggableInfo","invalidateShadow","onChildPositionCaptured","isCaptured","newDraggables","pop","sourceContainer","shouldAcceptDrop","sourceOptions","parentWrapper","relevantContainers","registerToParentContainer","isPosInChildContainer","calculateTranslations","setParentContainer","getParentContainer","sourceContainerProps","Container","_mediator2","setOptions","add","getContainer","wrapChild","findDraggebleAtPos","withRespectToMiddlePoints","find","startIndex","endIndex","_layout$getBeginEnd","middleIndex","floor","_layout$getBeginEnd2","getRelaventParentContainer","containerOfParentElement","draggable","parentInfo","getRemovedItem","_ref6","prevRemovedIndex","_ref7","setRemovedItemVisibilty","_ref8","_ref9","_ref10","_ref11","notifyParentOnPositionCapture","_ref12","_ref13","getElementSize","_ref14","_ref15","handleTargetContainer","_ref16","_ref17","setTargetContainer","invalidateShadowBeginEndIfNeeded","shadowBoundsGetter","getShadowBeginEnd","_ref20","getNextAddedIndex","_ref18","findDraggable","getIndexForPos","_ref19","_ref19$dragResult","beginAdjustment","_ref21","resetShadowAdjustment","lastAddedIndex","_ref22","_ref22$dragResult","handleInsertionSizeChange","_ref23","strectherElement","stretcherElementAdded","_ref24","_ref24$dragResult","containerBeginEnd","containerEnd","lastDraggableEnd","stretcherSize","toRemove","_ref25","prevAddedIndex","_ref26","_ref26$dragResult","_ref27","_ref28","beforeIndex","afterBounds","beforeBounds","beforeSize","threshold","afterIndex","afterSize","handleFirstInsertShadowAdjustment","_ref29","_ref29$dragResult","functions","hydratedFunctions","compose","_container","dropHandlers"],"mappings":"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","file":"index.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"SmoothDND\"] = factory();\n\telse\n\t\troot[\"SmoothDND\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 8);\n","export const containerInstance = 'smooth-dnd-container-instance';\r\nexport const containersInDraggable = 'smooth-dnd-containers-in-draggable';\r\n\r\nexport const defaultGroupName = '@@smooth-dnd-default-group@@';\r\nexport const wrapperClass = 'smooth-dnd-draggable-wrapper';\r\nexport const defaultGrabHandleClass = 'smooth-dnd-default-grap-handle';\r\nexport const animationClass = 'animated';\r\nexport const translationValue = '__smooth_dnd_draggable_translation_value';\r\nexport const visibilityValue = '__smooth_dnd_draggable_visibility_value';\r\nexport const ghostClass = 'smooth-dnd-ghost';\r\n\r\nexport const containerClass = 'smooth-dnd-container';\r\n\r\nexport const extraSizeForInsertion = 'smooth-dnd-extra-size-for-insertion';\r\nexport const stretcherElementClass = 'smooth-dnd-stretcher-element';\r\nexport const stretcherElementInstance = 'smooth-dnd-stretcher-instance';\r\n\r\nexport const isDraggableDetached = 'smoth-dnd-is-draggable-detached';\r\n\r\nexport const disbaleTouchActions = 'smooth-dnd-disable-touch-action';\r\nexport const noUserSelectClass = 'smooth-dnd-no-user-select';\r\n","export const getIntersection = (rect1, rect2) => {\r\n  return {\r\n    left: Math.max(rect1.left, rect2.left),\r\n    top: Math.max(rect1.top, rect2.top),\r\n    right: Math.min(rect1.right, rect2.right),\r\n    bottom: Math.min(rect1.bottom, rect2.bottom),\r\n  }\r\n}\r\n\r\nexport const getIntersectionOnAxis = (rect1, rect2, axis) => {\r\n  if (axis === 'x') {\r\n    return {\r\n      left: Math.max(rect1.left, rect2.left),\r\n      top: rect1.top,\r\n      right: Math.min(rect1.right, rect2.right),\r\n      bottom: rect1.bottom\r\n    }\r\n  } else {\r\n    return {\r\n      left: rect1.left,\r\n      top: Math.max(rect1.top, rect2.top),\r\n      right: rect1.right,\r\n      bottom: Math.min(rect1.bottom, rect2.bottom),\r\n    }\r\n  }\r\n}\r\n\r\nexport const getContainerRect = (element) => {\r\n  const _rect = element.getBoundingClientRect();\r\n  const rect = { \r\n    left: _rect.left,\r\n    right: _rect.right + 10,\r\n    top: _rect.top,\r\n    bottom: _rect.bottom\r\n  }\r\n  \r\n  if (hasBiggerChild(element, 'x') && !isScrollingOrHidden(element, 'x')) {\r\n    const width = rect.right - rect.left;\r\n    rect.right = rect.right + element.scrollWidth - width;\r\n  }\r\n\r\n  if (hasBiggerChild(element, 'y') && !isScrollingOrHidden(element, 'y')) {\r\n    const height = rect.bottom - rect.top;\r\n    rect.bottom = rect.bottom + element.scrollHeight - height;\r\n  }\r\n\r\n  return rect;\r\n}\r\n\r\nexport const isScrolling = (element, axis) => {\r\n  const style = window.getComputedStyle(element);\r\n  const overflow = style['overflow'];\r\n  const overFlowAxis = style[`overflow-${axis}`];\r\n  const general = overflow === 'auto' || overflow === 'scroll';\r\n  const dimensionScroll = overFlowAxis === 'auto' || overFlowAxis === 'scroll';\r\n  return general || dimensionScroll;\r\n}\r\n\r\nexport const isScrollingOrHidden = (element, axis) => {\r\n  const style = window.getComputedStyle(element);\r\n  const overflow = style['overflow'];\r\n  const overFlowAxis = style[`overflow-${axis}`];\r\n  const general = overflow === 'auto' || overflow === 'scroll' || overflow === 'hidden';\r\n  const dimensionScroll = overFlowAxis === 'auto' || overFlowAxis === 'scroll' || overFlowAxis === 'hidden';\r\n  return general || dimensionScroll;\r\n}\r\n\r\nexport const hasBiggerChild = (element, axis) => {\r\n  if (axis === 'x') {\r\n    return element.scrollWidth > element.clientWidth\r\n  } else {\r\n    return element.scrollHeight > element.clientHeight;\r\n  }\r\n}\r\n\r\nexport const hasScrollBar = (element, axis) => {\r\n  return hasBiggerChild(element, axis) && isScrolling(element, axis);\r\n}\r\n\r\nexport const getVisibleRect = (element, elementRect) => {\r\n  let currentElement = element;\r\n  let rect = elementRect || getContainerRect(element);\r\n  currentElement = element.parentElement;\r\n  while (currentElement) {\r\n    if (hasBiggerChild(currentElement, 'x') && isScrollingOrHidden(currentElement, 'x')) {\r\n      rect = getIntersectionOnAxis(rect, currentElement.getBoundingClientRect(), 'x');\r\n    }\r\n\r\n    if (hasBiggerChild(currentElement, 'y') && isScrollingOrHidden(currentElement, 'y')) {\r\n      rect = getIntersectionOnAxis(rect, currentElement.getBoundingClientRect(), 'y');\r\n    }\r\n\r\n    currentElement = currentElement.parentElement;\r\n  }\r\n\r\n  return rect;\r\n}\r\n\r\nexport const listenScrollParent = (element, clb) => {\r\n  let scrollers = [];\r\n  const dispose = () => {\r\n    scrollers.forEach(p => {\r\n      p.removeEventListener('scroll', clb);\r\n    });\r\n    window.removeEventListener('scroll', clb);\r\n  }\r\n\r\n  setTimeout(function() {\r\n    let currentElement = element;\r\n    while (currentElement) {\r\n      if (isScrolling(currentElement, 'x') || isScrolling(currentElement, 'y')) {\r\n        currentElement.addEventListener('scroll', clb);\r\n        scrollers.push(currentElement);\r\n      }\r\n      currentElement = currentElement.parentElement;\r\n    }\r\n\r\n    window.addEventListener('scroll', clb);\r\n  }, 10);\r\n\r\n  return {\r\n    dispose\r\n  }\r\n}\r\n\r\nexport const hasParent = (element, parent) => {\r\n  let current = element;\r\n  while (current) {\r\n    if (current === parent) {\r\n      return true;\r\n    }\r\n    current = current.parentElement;\r\n  }\r\n  return false;\r\n}\r\n\r\nexport const getParent = (element, selector) => {\r\n  let current = element;\r\n  while (current) {\r\n    if (current.matches(selector)) {\r\n      return current;\r\n    }\r\n    current = current.parentElement;\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\nexport const hasClass = (element, cls) => {\r\n  return element.className.split(' ').map(p => p).indexOf(cls) > -1;\r\n}\r\n\r\nexport const addClass = (element, cls) => {\r\n  const classes = element.className.split(' ').filter(p => p);\r\n  if (classes.indexOf(cls) === -1) {\r\n    classes.push(cls);\r\n    element.className = classes.join(' ');\r\n  }\r\n}\r\n\r\nexport const removeClass = (element, cls) => {\r\n  const classes = element.className.split(' ').filter(p => p && p !== cls);\r\n  element.className = classes.join(' ');\r\n}\r\n\r\nexport const debounce = (fn, delay, immediate) => {\r\n  let timer = null;\r\n  return (...params) => {\r\n    if (timer) {\r\n      clearTimeout(timer);\r\n    }\r\n    if (immediate && !timer) {\r\n      fn.call(this, ...params);\r\n    } else {\r\n      timer = setTimeout(() => {\r\n        timer = null;\r\n        fn.call(this, ...params);\r\n      }, delay);\r\n    }\r\n  }\r\n}\r\n\r\nexport const removeChildAt = (parent, index) => {\r\n  return parent.removeChild(parent.children[index]);\r\n}\r\n\r\nexport const addChildAt = (parent, child, index) => {\r\n  if (index >= parent.children.lenght) {\r\n    parent.appendChild(child);\r\n  } else {\r\n    parent.insertBefore(child, parent.children[index]);\r\n  }\r\n}\r\n\r\nexport const isMobile = () => {\r\n  if (navigator.userAgent.match(/Android/i)\r\n    || navigator.userAgent.match(/webOS/i)\r\n    || navigator.userAgent.match(/iPhone/i)\r\n    || navigator.userAgent.match(/iPad/i)\r\n    || navigator.userAgent.match(/iPod/i)\r\n    || navigator.userAgent.match(/BlackBerry/i)\r\n    || navigator.userAgent.match(/Windows Phone/i)\r\n  ) {\r\n    return true;\r\n  }\r\n  else {\r\n    return false;\r\n  }\r\n}","import { addChildAt, removeChildAt } from './utils';\r\nimport {\r\n\twrapperClass,\r\n\tanimationClass,\r\n\tcontainersInDraggable\r\n} from './constants';\r\n\r\n\r\nexport function domDropHandler({ element, draggables, layout, options }) {\r\n\treturn (dropResult, onDrop) => {\r\n\t\tconst { removedIndex, addedIndex, droppedElement } = dropResult;\r\n\t\tlet removedWrapper = null;\r\n\t\tif (removedIndex !== null) {\r\n\t\t\tremovedWrapper = removeChildAt(element, removedIndex);\r\n\t\t\tdraggables.splice(removedIndex, 1);\r\n\t\t}\r\n\r\n\t\tif (addedIndex !== null) {\r\n\t\t\tconst wrapper = document.createElement('div');\r\n\t\t\twrapper.className = `${wrapperClass} ${options.orientation} ${animationClass} `;\r\n\t\t\twrapper.appendChild(removedWrapper.firstChild || droppedElement);\r\n\t\t\twrapper[containersInDraggable] = [];\r\n\t\t\taddChildAt(element, wrapper, addedIndex);\r\n\t\t\tif (addedIndex >= draggables.length) {\r\n\t\t\t\tdraggables.push(wrapper);\r\n\t\t\t} else {\r\n\t\t\t\tdraggables.splice(addedIndex, 0, wrapper);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (onDrop) {\r\n\t\t\tonDrop(dropResult);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nexport function reactDropHandler() {\r\n\tconst handler = ({ element, draggables, layout, options }) => {\r\n\t\treturn (dropResult, onDrop) => {\r\n\t\t\tif (onDrop) {\r\n\t\t\t\tonDrop(dropResult);\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n\r\n\treturn {\r\n\t\thandler\r\n\t};\r\n}","import * as constants from './constants';\r\n\r\nconst css = {\r\n\t[`.${constants.containerClass}`]: {\r\n\t\t'position': 'relative',\r\n\t},\r\n\t[`.${constants.containerClass} *`]: {\r\n\t\t'box-sizing': 'border-box',\r\n\t},\r\n\t[`.${constants.containerClass}.horizontal`]: {\r\n\t\t'white-space': 'nowrap',\r\n\t},\r\n\t[`.${constants.containerClass}.horizontal .${constants.wrapperClass}`]: {\r\n\t\t'height': '100%',\r\n\t\t'display': 'inline-block'\r\n\t},\r\n\t[`.${constants.wrapperClass}`]: {\r\n\t\t'overflow': 'hidden'\r\n\t},\r\n\t[`.${constants.wrapperClass}.animated`]: {\r\n\t\t'transition': 'transform ease'\r\n\t},\r\n\t[`.${constants.ghostClass} *`]: {\r\n\t\t'box-sizing': 'border-box',\r\n\t},\r\n\t[`.${constants.ghostClass}.animated`]: {\r\n\t\t'transition': 'all ease-in-out'\r\n\t},\r\n\t[`.${constants.disbaleTouchActions} *`]: {\r\n\t\t'touch-actions': 'none',\r\n\t\t'-ms-touch-actions': 'none'\r\n\t}\r\n};\r\n\r\nfunction convertToCssString(css) {\r\n\treturn Object.entries(css).reduce((styleString, [propName, propValue]) => {\r\n\t\tif (typeof (propValue) === 'object') {\r\n\t\t\treturn `${styleString}${propName}{${convertToCssString(propValue)}}`;\r\n\t\t}\r\n\t\treturn `${styleString}${propName}:${propValue};`;\r\n\t}, '');\r\n}\r\n\r\nfunction addStyleToHead() {\t\r\n\tconst head = document.head || document.getElementsByTagName('head')[0];\r\n\tconst style = document.createElement('style');\r\n\tconst cssString = convertToCssString(css);\r\n\tstyle.type = 'text/css';\r\n\tif (style.styleSheet) {\r\n\t\tstyle.styleSheet.cssText = cssString;\r\n\t} else {\r\n\t\tstyle.appendChild(document.createTextNode(cssString));\r\n\t}\r\n\r\n\thead.appendChild(style);\r\n}\r\n\r\nexport {\r\n\taddStyleToHead\r\n};","import * as Utils from './utils';\r\nimport * as constants from './constants';\r\nimport { addStyleToHead } from './styles';\r\n\r\nconst grabEvents = ['mousedown', 'touchstart'];\r\nconst moveEvents = ['mousemove', 'touchmove'];\r\nconst releaseEvents = ['mouseup', 'touchend'];\r\n\r\nlet dragListeningContainers = null;\r\nlet grabbedElement = null;\r\nlet ghostInfo = null;\r\nlet draggableInfo = null;\r\nlet containers = [];\r\nlet isDragging = false;\r\nlet removedElement = null;\r\n\r\n// Utils.addClass(document.body, 'clearfix');\r\n\r\nconst isMobile = Utils.isMobile();\r\n\r\nfunction listenEvents() {\r\n\taddGrabListeners();\r\n}\r\n\r\nfunction addGrabListeners() {\r\n\tgrabEvents.forEach(e => {\r\n\t\twindow.document.addEventListener(e, onMouseDown, {passive: false});\r\n\t});\r\n}\r\n\r\nfunction addMoveListeners() {\r\n\tmoveEvents.forEach(e => {\r\n\t\twindow.document.addEventListener(e, onMouseMove, { passive: false });\r\n\t});\r\n}\r\n\r\nfunction removeMoveListeners() {\r\n\tmoveEvents.forEach(e => {\r\n\t\twindow.document.removeEventListener(e, onMouseMove, { passive: false });\r\n\t});\r\n}\r\n\r\nfunction addReleaseListeners() {\r\n\treleaseEvents.forEach(e => {\r\n\t\twindow.document.addEventListener(e, onMouseUp, { passive: false });\r\n\t});\r\n}\r\n\r\nfunction removeReleaseListeners() {\r\n\treleaseEvents.forEach(e => {\r\n\t\twindow.document.removeEventListener(e, onMouseUp, { passive: false });\r\n\t});\r\n}\r\n\r\nfunction getGhostElement(element, { x, y }, container) {\r\n\tconst { scaleX = 1, scaleY = 1 } = container.getScale();\r\n\tconst { left, top, right, bottom } = element.getBoundingClientRect();\t\r\n\tconst midX = left + ((right - left) / 2);\r\n\tconst midY = top + ((bottom - top) / 2);\r\n\tconst div = document.createElement('div');\r\n\tdiv.style.position = 'fixed';\r\n\tdiv.style.pointerEvents = 'none';\r\n\tdiv.style.left = left + 'px';\r\n\tdiv.style.top = top + 'px';\r\n\tdiv.style.width = right - left + 'px';\r\n\tdiv.style.height = bottom - top + 'px';\r\n\tdiv.style.overflow = 'hidden';\r\n\tdiv.className = constants.ghostClass;\r\n\tconst clone = element.cloneNode(true);\r\n\tif (container.getOptions().dragClass) {\r\n\t\tUtils.addClass(clone.childNodes[0], container.getOptions().dragClass);\r\n\t}\r\n\tclone.style.width = ((right - left) / scaleX) + 'px';\r\n\tclone.style.height = ((bottom - top) / scaleY) + 'px';\r\n\tclone.style.transform = `scale3d(${scaleX || 1}, ${scaleY || 1}, 1)`;\r\n\tclone.style.transformOrigin = '0 0 0';\r\n\tclone.style.margin = '0px';\r\n\tdiv.appendChild(clone);\r\n\r\n\treturn {\r\n\t\tghost: div,\r\n\t\tcenterDelta: { x: midX - x, y: midY - y },\r\n\t\tpositionDelta: { left: left - x, top: top - y },\r\n\t\tclientWidth: right - left,\r\n\t\tclientHeight: bottom - top\r\n\t};\r\n}\r\n\r\nfunction getDraggableInfo(draggableElement) {\r\n\tconst container = containers.filter(p => draggableElement.parentElement === p.element)[0];\r\n\tconst draggableIndex = container.draggables.indexOf(draggableElement);\r\n\treturn {\r\n\t\tcontainer,\r\n\t\telement: draggableElement,\r\n\t\telementIndex: draggableIndex,\r\n\t\tpayload: container.getChildPayload(draggableIndex),\r\n\t\ttargetElement: null,\r\n\t\tposition: { x: 0, y: 0 },\r\n\t\tgroupName: container.groupName\r\n\t};\r\n}\r\n\r\nfunction handleDropAnimation(callback) {\r\n\tfunction endDrop() {\r\n\t\tUtils.removeClass(ghostInfo.ghost, 'animated');\r\n\t\tghostInfo.ghost.style.transitionDuration = null;\r\n\t\tdocument.body.removeChild(ghostInfo.ghost);\r\n\t\tcallback();\r\n\t}\r\n\r\n\tfunction animateGhostToPosition({ top, left }, duration) {\r\n\t\tUtils.addClass(ghostInfo.ghost, 'animated');\r\n\t\tghostInfo.ghost.style.transitionDuration = duration + 'ms';\r\n\t\tghostInfo.ghost.style.left = left + 'px';\r\n\t\tghostInfo.ghost.style.top = top + 'px';\r\n\t\tsetTimeout(function() {\r\n\t\t\tendDrop();\r\n\t\t}, duration + 10);\r\n\t}\r\n\r\n\tif (draggableInfo.targetElement) {\r\n\t\tconst container = containers.filter(p => p.element === draggableInfo.targetElement)[0];\r\n\t\tif (container.shouldAnimateDrop()) {\r\n\t\t\tconst dragResult = container.getDragResult();\r\n\t\t\tanimateGhostToPosition(dragResult.shadowBeginEnd.rect, Math.max(150, container.getOptions().animationDuration / 2));\r\n\t\t} else {\r\n\t\t\tendDrop();\r\n\t\t}\r\n\t} else {\r\n\t\tconst container = containers.filter(p => p === draggableInfo.container)[0];\r\n\t\tif (container.getOptions().behaviour === 'move') {\r\n\t\t\tconst { removedIndex, elementSize } = container.getDragResult();\r\n\t\t\tconst layout = container.layout;\r\n\t\t\t// drag ghost to back\r\n\t\t\tcontainer.getTranslateCalculator({\r\n\t\t\t\tdragResult: {\r\n\t\t\t\t\tremovedIndex,\r\n\t\t\t\t\taddedIndex: removedIndex,\r\n\t\t\t\t\telementSize\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tconst prevDraggableEnd = removedIndex > 0 ? layout.getBeginEnd(container.draggables[removedIndex - 1]).end : layout.getBeginEndOfContainer().begin;\r\n\t\t\tanimateGhostToPosition(layout.getTopLeftOfElementBegin(prevDraggableEnd), container.getOptions().animationDuration);\r\n\t\t} else {\r\n\t\t\tUtils.addClass(ghostInfo.ghost, 'animated');\r\n\t\t\tghostInfo.ghost.style.transitionDuration = container.getOptions().animationDuration + 'ms';\r\n\t\t\tghostInfo.ghost.style.opacity = '0';\r\n\t\t\tghostInfo.ghost.style.transform = 'scale(0.90)';\r\n\t\t\tsetTimeout(function() {\r\n\t\t\t\tendDrop();\r\n\t\t\t}, container.getOptions().animationDuration);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nconst handleDragStartConditions = (function handleDragStartConditions() {\r\n\tlet startEvent;\r\n\tlet delay;\r\n\tlet clb;\r\n\tlet timer = null;\r\n\tconst moveThreshold = 1;\r\n\tconst maxMoveInDelay = 8;\r\n\r\n\tfunction onMove(event) {\r\n\t\tconst { clientX: currentX, clientY: currentY } = getPointerEvent(event);\r\n\t\tif (!delay) {\r\n\t\t\tif (Math.abs(startEvent.clientX - currentX) > moveThreshold || Math.abs(startEvent.clientY - currentY) > moveThreshold) {\r\n\t\t\t\treturn callCallback();\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (Math.abs(startEvent.clientX - currentX) > maxMoveInDelay || Math.abs(startEvent.clientY - currentY) > maxMoveInDelay) {\r\n\t\t\t\tderegisterEvent();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onUp() { deregisterEvent(); }\r\n\tfunction onHTMLDrag() { deregisterEvent(); }\r\n\r\n\tfunction registerEvents() {\r\n\t\tif (delay) {\r\n\t\t\ttimer = setTimeout(callCallback, delay);\r\n\t\t}\r\n\r\n\t\tmoveEvents.forEach(e => window.document.addEventListener(e, onMove), { passive: false });\r\n\t\treleaseEvents.forEach(e => window.document.addEventListener(e, onUp), { passive: false });\r\n\t\tdocument.addEventListener('drag', onHTMLDrag, { passive: false });\r\n\t}\r\n\r\n\tfunction deregisterEvent() {\r\n\t\tclearTimeout(timer);\r\n\t\tmoveEvents.forEach(e => window.document.removeEventListener(e, onMove), { passive: false });\r\n\t\treleaseEvents.forEach(e => window.document.removeEventListener(e, onUp), { passive: false });\r\n\t\tdocument.removeEventListener('drag', onHTMLDrag, { passive: false });\r\n\t}\r\n\r\n\tfunction callCallback() {\r\n\t\tclearTimeout(timer);\r\n\t\tderegisterEvent();\r\n\t\tclb();\r\n\t}\r\n\r\n\treturn function(_startEvent, _delay, _clb) {\r\n\t\tstartEvent = getPointerEvent(_startEvent);\r\n\t\tdelay = _delay || (isMobile ? 200 : 0);\r\n\t\tclb = _clb;\r\n\r\n\t\tregisterEvents();\r\n\t};\r\n})();\r\n\r\nfunction onMouseDown(event) {\r\n\tconst e = getPointerEvent(event);\r\n\tif (!isDragging) {\r\n\t\tgrabbedElement = Utils.getParent(e.target, '.' + constants.wrapperClass);\r\n\t\tif (grabbedElement) {\r\n\t\t\tconst containerElement = Utils.getParent(grabbedElement, '.' + constants.containerClass);\r\n\t\t\tconst container = containers.filter(p => p.element === containerElement)[0];\r\n\t\t\tconst dragHandleSelector = container.getOptions().dragHandleSelector;\r\n\t\t\tconst nonDragAreaSelector = container.getOptions().nonDragAreaSelector;\r\n\r\n\t\t\tlet startDrag = true;\r\n\t\t\tif (dragHandleSelector && !Utils.getParent(e.target, dragHandleSelector)) {\r\n\t\t\t\tstartDrag = false;\r\n\t\t\t}\r\n\r\n\t\t\tif (nonDragAreaSelector && Utils.getParent(e.target, nonDragAreaSelector)) {\r\n\t\t\t\tstartDrag = false;\r\n\t\t\t}\r\n\r\n\t\t\tif (startDrag) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\thandleDragStartConditions(e, container.getOptions().dragBeginDelay, () => {\t\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\twindow.getSelection().empty();\r\n\t\t\t\t\t}, 0);\r\n\t\t\t\t\tinitiateDrag(e);\r\n\t\t\t\t\taddMoveListeners();\r\n\t\t\t\t\taddReleaseListeners();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction onMouseUp() {\r\n\tremoveMoveListeners();\r\n\tremoveReleaseListeners();\r\n\tif (draggableInfo) {\r\n\t\thandleDropAnimation(() => {\r\n\t\t\tdocument.body.style.touchAction = null;\r\n\t\t\t(dragListeningContainers || []).forEach(p => {\r\n\t\t\t\tUtils.removeClass(p.element, constants.noUserSelectClass);\r\n\t\t\t\tp.handleDrop(draggableInfo);\r\n\t\t\t});\r\n\r\n\t\t\tdragListeningContainers = null;\r\n\t\t\tgrabbedElement = null;\r\n\t\t\tghostInfo = null;\r\n\t\t\tdraggableInfo = null;\r\n\t\t\tisDragging = false;\r\n\t\t});\r\n\t}\r\n}\r\n\r\nfunction getPointerEvent(e) {\r\n\treturn e.touches ? e.touches[0] : e;\t\r\n}\r\n\r\nfunction initiateDrag(position) {\r\n\tisDragging = true;\r\n\tconst container = containers.filter(p => grabbedElement.parentElement === p.element)[0];\r\n\tcontainer.setDraggables();\r\n\t\r\n\tdraggableInfo = getDraggableInfo(grabbedElement);\r\n\tghostInfo = getGhostElement(grabbedElement, { x: position.clientX, y: position.clientY }, draggableInfo.container);\r\n\tdraggableInfo.position = {\r\n\t\tx: position.clientX + ghostInfo.centerDelta.x,\r\n\t\ty: position.clientY + ghostInfo.centerDelta.y\r\n\t};\r\n\r\n\tdocument.body.appendChild(ghostInfo.ghost);\r\n\r\n\r\n\tdragListeningContainers = containers.filter(p => p.isDragRelevant(container, draggableInfo.payload));\r\n\tdragListeningContainers.forEach(p => Utils.addClass(p.element, constants.noUserSelectClass));\r\n\tdragListeningContainers.forEach(p => p.prepareDrag(p, dragListeningContainers));\r\n\tdragListeningContainers.forEach(p => p.handleDrag(draggableInfo));\t\r\n}\r\n\r\nfunction onMouseMove(event) {\r\n\tevent.preventDefault();\r\n\tconst e = getPointerEvent(event);\r\n\tif (!draggableInfo) {\r\n\t\tinitiateDrag(e);\r\n\t} else {\r\n\t\t// just update ghost position && draggableInfo position\r\n\t\tghostInfo.ghost.style.left = `${e.clientX + ghostInfo.positionDelta.left}px`;\r\n\t\tghostInfo.ghost.style.top = `${e.clientY + ghostInfo.positionDelta.top}px`;\r\n\t\tdraggableInfo.position.x = e.clientX + ghostInfo.centerDelta.x;\r\n\t\tdraggableInfo.position.y = e.clientY + ghostInfo.centerDelta.y;\r\n\t\tdraggableInfo.clientWidth = ghostInfo.clientWidth;\r\n\t\tdraggableInfo.clientHeight = ghostInfo.clientHeight;\r\n\t\tdragListeningContainers.forEach(p => p.handleDrag(draggableInfo));\r\n\t}\r\n}\r\n\r\nfunction Mediator() {\r\n\tlistenEvents();\r\n\treturn {\r\n\t\tregister: function(container) {\r\n\t\t\tcontainers.push(container);\r\n\t\t},\r\n\t\tunregister: function(container) {\r\n\t\t\tcontainers.splice(containers.indexOf(container), 1);\r\n\t\t}\r\n\t};\r\n}\r\n\r\naddStyleToHead();\r\n\r\nexport default Mediator();\r\n\r\n\r\n\r\n","import * as Utils from './utils';\r\nimport { translationValue, visibilityValue, extraSizeForInsertion, containersInDraggable } from './constants';\r\n\r\n\r\n\r\nconst horizontalMap = {\r\n\tsize: 'offsetWidth',\r\n\tdistanceToParent: 'offsetLeft',\r\n\ttranslate: 'transform',\r\n\tbegin: 'left',\r\n\tend: 'right',\r\n\tdragPosition: 'x',\r\n\tscrollSize: 'scrollWidth',\r\n\toffsetSize: 'offsetWidth',\r\n\tscrollValue: 'scrollLeft',\r\n\tscale: 'scaleX',\r\n\tsetSize: 'width',\r\n\tsetters: {\r\n\t\t'translate': (val) => `translate3d(${val}px, 0, 0)`\r\n\t}\r\n};\r\n\r\nconst verticalMap = {\r\n\tsize: 'offsetHeight',\r\n\tdistanceToParent: 'offsetTop',\r\n\ttranslate: 'transform',\r\n\tbegin: 'top',\r\n\tend: 'bottom',\r\n\tdragPosition: 'y',\r\n\tscrollSize: 'scrollHeight',\r\n\toffsetSize: 'offsetHeight',\r\n\tscrollValue: 'scrollTop',\r\n\tscale: 'scaleY',\r\n\tsetSize: 'height',\r\n\tsetters: {\r\n\t\t'translate': (val) => `translate3d(0,${val}px, 0)`\r\n\t}\r\n};\r\n\r\nfunction orientationDependentProps(map) {\r\n\tfunction get(obj, prop) {\r\n\t\tconst mappedProp = map[prop];\r\n\t\treturn obj[mappedProp || prop];\r\n\t}\r\n\r\n\tfunction set(obj, prop, value) {\r\n\t\trequestAnimationFrame(() => {\r\n\t\t\tobj[map[prop]] = map.setters[prop] ? map.setters[prop](value) : value;\r\n\t\t});\r\n\t}\r\n\r\n\treturn { get, set };\r\n}\r\n\r\nexport default function layoutManager(containerElement, orientation, _animationDuration) {\r\n\tcontainerElement[extraSizeForInsertion] = 0;\r\n\tconst animationDuration = _animationDuration;\r\n\tconst map = orientation === 'horizontal' ? horizontalMap : verticalMap;\r\n\tconst propMapper = orientationDependentProps(map);\r\n\tconst values = {\r\n\t\ttranslation: 0\r\n\t};\r\n\tlet registeredScrollListener = null;\r\n\r\n\twindow.addEventListener('resize', function() {\r\n\t\tinvalidateContainerRectangles(containerElement);\r\n\t\t// invalidateContainerScale(containerElement);\r\n\t});\r\n\r\n\tsetTimeout(() => {\r\n\t\tinvalidate();\r\n\t}, 10);\r\n\t// invalidate();\r\n\r\n\tconst scrollListener = Utils.listenScrollParent(containerElement, function() {\r\n\t\tinvalidateContainerRectangles(containerElement);\r\n\t\tregisteredScrollListener && registeredScrollListener();\r\n\t});\r\n\tfunction invalidate() {\r\n\t\tinvalidateContainerRectangles(containerElement);\r\n\t\tinvalidateContainerScale(containerElement);\r\n\t}\r\n\r\n\tlet visibleRect;\r\n\tfunction invalidateContainerRectangles(containerElement) {\r\n\t\tvalues.rect = Utils.getContainerRect(containerElement);\r\n\t\tvalues.visibleRect = Utils.getVisibleRect(containerElement, values.rect);\r\n\r\n\t\t// if (visibleRect) {\r\n\t\t//   visibleRect.parentNode.removeChild(visibleRect);\r\n\t\t// }\r\n\t\t// visibleRect = document.createElement('div');\r\n\t\t// visibleRect.style.position = 'fixed';\r\n\t\t// visibleRect.style.border = '1px solid red';\r\n\t\t// visibleRect.style.top = values.visibleRect.top + 'px';\r\n\t\t// visibleRect.style.left = values.visibleRect.left + 'px';\r\n\t\t// visibleRect.style.width = values.visibleRect.right - values.visibleRect.left + 'px';\r\n\t\t// visibleRect.style.height = values.visibleRect.bottom - values.visibleRect.top + 'px';\r\n\t\t// document.body.appendChild(visibleRect);\r\n\r\n\t}\r\n\r\n\tfunction invalidateContainerScale(containerElement) {\r\n\t\tconst rect = containerElement.getBoundingClientRect();\r\n\t\tvalues.scaleX = (rect.right - rect.left) / containerElement.offsetWidth;\r\n\t\tvalues.scaleY = (rect.bottom - rect.top) / containerElement.offsetHeight;\r\n\t}\r\n\r\n\tfunction getContainerRectangles() {\r\n\t\treturn {\r\n\t\t\trect: values.rect,\r\n\t\t\tvisibleRect: values.visibleRect\r\n\t\t};\r\n\t}\r\n\r\n\tfunction getBeginEndOfDOMRect(rect) {\r\n\t\treturn {\r\n\t\t\tbegin: propMapper.get(rect, 'begin'),\r\n\t\t\tend: propMapper.get(rect, 'end')\r\n\t\t};\r\n\t}\r\n\r\n\tfunction getBeginEndOfContainer() {\r\n\t\tconst begin = propMapper.get(values.rect, 'begin') + values.translation;\r\n\t\tconst end = propMapper.get(values.rect, 'end') + values.translation;\r\n\t\treturn { begin, end };\r\n\t}\r\n\r\n\tfunction getBeginEndOfContainerVisibleRect() {\r\n\t\tconst begin = propMapper.get(values.visibleRect, 'begin') + values.translation;\r\n\t\tconst end = propMapper.get(values.visibleRect, 'end') + values.translation;\r\n\t\treturn { begin, end };\r\n\t}\r\n\r\n\tfunction getContainerScale() {\r\n\t\treturn { scaleX: values.scaleX, scaleY: values.scaleY };\r\n\t}\r\n\r\n\tfunction getSize(element) {\r\n\t\treturn propMapper.get(element, 'size') * propMapper.get(values, 'scale');\r\n\t}\r\n\r\n\tfunction getDistanceToOffsetParent(element) {\r\n\t\tconst distance = propMapper.get(element, 'distanceToParent') + (element[translationValue] || 0);\r\n\t\treturn distance * propMapper.get(values, 'scale');\r\n\t}\r\n\r\n\tfunction getBeginEnd(element) {\r\n\t\tconst begin = getDistanceToOffsetParent(element) + (propMapper.get(values.rect, 'begin') + values.translation) - propMapper.get(containerElement, 'scrollValue');\r\n\t\treturn {\r\n\t\t\tbegin,\r\n\t\t\tend: begin + getSize(element) * propMapper.get(values, 'scale')\r\n\t\t};\r\n\t}\r\n\r\n\tfunction setSize(element, size) {\r\n\t\tpropMapper.set(element, 'setSize', size);\r\n\t}\r\n\r\n\tfunction getAxisValue(position) {\r\n\t\treturn propMapper.get(position, 'dragPosition');\r\n\t}\r\n\r\n\tfunction updateDescendantContainerRects(container) {\r\n\t\tcontainer.layout.invalidateRects();\r\n\t\tcontainer.onTranslated();\r\n\t\tif (container.getChildContainers()) {\r\n\t\t\tcontainer.getChildContainers().forEach(p => updateDescendantContainerRects(p));\r\n\t\t}\r\n\t}\r\n\r\n\tfunction setTranslation(element, translation) {\r\n\t\tif (getTranslation(element) !== translation) {\r\n\t\t\tif (!translation) {\r\n\t\t\t\telement.style.removeProperty('transform');\r\n\t\t\t} else {\r\n\t\t\t\tpropMapper.set(element.style, 'translate', translation);\r\n\t\t\t}\r\n\t\t\telement[translationValue] = translation;\r\n\r\n\t\t\tif (element[containersInDraggable]) {\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\telement[containersInDraggable].forEach(p => {\r\n\t\t\t\t\t\tupdateDescendantContainerRects(p);\r\n\t\t\t\t\t});\r\n\t\t\t\t}, animationDuration + 20);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getTranslation(element) {\r\n\t\treturn element[translationValue];\r\n\t}\r\n\r\n\tfunction setVisibility(element, isVisible) {\r\n\t\tif (element[visibilityValue] === undefined || element[visibilityValue] !== isVisible) {\r\n\t\t\tif (isVisible) {\r\n\t\t\t\telement.style.removeProperty('visibility');\r\n\t\t\t} else {\r\n\t\t\t\telement.style.visibility = 'hidden';\r\n\t\t\t}\r\n\t\t\telement[visibilityValue] = isVisible;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction isVisible(element) {\r\n\t\treturn element[visibilityValue] === undefined || element[visibilityValue];\r\n\t}\r\n\r\n\tfunction isInVisibleRect(x, y) {\r\n\t\tconst { left, top, right, bottom } = values.visibleRect;\r\n\t\tif (orientation === 'vertical') {\r\n\t\t\treturn x > left && x < right && y > top && y < bottom;\r\n\t\t} else {\r\n\t\t\treturn x > left && x < right  && y > top && y < bottom;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction setScrollListener(callback) {\r\n\t\tregisteredScrollListener = callback;\r\n\t}\r\n\r\n\tfunction getTopLeftOfElementBegin(begin) {\r\n\t\tlet top = 0;\r\n\t\tlet left = 0;\r\n\t\tif (orientation === 'horizontal') {\r\n\t\t\tleft = begin;\r\n\t\t\ttop = values.rect.top;\r\n\t\t} else {\r\n\t\t\tleft = values.rect.left;\r\n\t\t\ttop = begin;\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\ttop, left\r\n\t\t};\r\n\t}\r\n\r\n\tfunction getScrollSize(element) {\r\n\t\treturn propMapper.get(element, 'scrollSize');\r\n\t}\r\n\r\n\tfunction getScrollValue(element) {\r\n\t\treturn propMapper.get(element, 'scrollValue');\r\n\t}\r\n\r\n\tfunction setScrollValue(element, val) {\r\n\t\treturn propMapper.set(element, 'scrollValue', val);\r\n\t}\r\n\r\n\tfunction dispose() {\r\n\t\tif (scrollListener) {\r\n\t\t\tscrollListener.dispose();\r\n\t\t}\r\n\r\n\t\tif (visibleRect) {\r\n\t\t\tvisibleRect.parentNode.removeChild(visibleRect);\r\n\t\t\tvisibleRect = null;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getPosition(position) {\r\n\t\treturn isInVisibleRect(position.x, position.y) ? getAxisValue(position) : null;\r\n\t}\r\n\r\n\tfunction invalidateRects() {\r\n\t\tinvalidateContainerRectangles(containerElement);\r\n\t}\r\n\r\n\treturn {\r\n\t\tgetSize,\r\n\t\t//getDistanceToContainerBegining,\r\n\t\tgetContainerRectangles,\r\n\t\tgetBeginEndOfDOMRect,\r\n\t\tgetBeginEndOfContainer,\r\n\t\tgetBeginEndOfContainerVisibleRect,\r\n\t\tgetBeginEnd,\r\n\t\tgetAxisValue,\r\n\t\tsetTranslation,\r\n\t\tgetTranslation,\r\n\t\tsetVisibility,\r\n\t\tisVisible,\r\n\t\tisInVisibleRect,\r\n\t\tdispose,\r\n\t\tgetContainerScale,\r\n\t\tsetScrollListener,\r\n\t\tsetSize,\r\n\t\tgetTopLeftOfElementBegin,\r\n\t\tgetScrollSize,\r\n\t\tgetScrollValue,\r\n\t\tsetScrollValue,\r\n\t\tinvalidate,\r\n\t\tinvalidateRects,\r\n\t\tgetPosition,\r\n\t};\r\n}","import { isScrolling } from './utils';\r\n\r\nconst maxSpeed = 1500; // px/s\r\nconst minSpeed = 20; // px/s\r\n\r\nfunction getScrollableParent(element, axis) {\r\n\tlet current = element;\r\n\twhile (current) {\r\n\t\tif (isScrolling(current)) {\r\n\t\t\treturn current;\r\n\t\t}\r\n\t\tcurrent = current.parentElement;\r\n\t}\r\n}\r\n\r\nfunction requestFrame(element, layout) {\r\n\tlet isAnimating = false;\r\n\tlet request = null;\r\n\tlet startTime = null;\r\n\tlet direction = null;\r\n\tlet speed = null;\r\n\r\n\tfunction animate(_direction, _speed) {\r\n\t\tdirection = _direction;\r\n\t\tspeed = _speed;\r\n\t\tisAnimating = true;\r\n\t\tif (isAnimating) {\r\n\t\t\tstart();\r\n\t\t}\r\n\t}\r\n\r\n\tfunction start() {\r\n\t\tif (request === null) {\r\n\t\t\trequest = requestAnimationFrame((timestamp) => {\r\n\t\t\t\tif (startTime === null) { startTime = timestamp; }\r\n\t\t\t\tconst timeDiff = timestamp - startTime;\r\n\t\t\t\tstartTime = timestamp;\r\n\t\t\t\tlet distanceDiff = (timeDiff / 1000) * speed;\r\n\t\t\t\tdistanceDiff = direction === 'begin' ? (0 - distanceDiff) : distanceDiff;\r\n\t\t\t\tconst scrollTo = layout.getScrollValue(element) + distanceDiff;\r\n\t\t\t\tlayout.setScrollValue(element, scrollTo);\r\n\t\t\t\t// console.log(scrollTo);\r\n\t\t\t\trequest = null;\r\n\t\t\t\tstart();\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tfunction stop() {\r\n\t\tif (isAnimating) {\r\n\t\t\tcancelAnimationFrame(request);\r\n\t\t\tisAnimating = false;\r\n\t\t\tstartTime = null;\r\n\t\t\trequest = null;\r\n\t\t}\r\n\t}\r\n\r\n\treturn {\r\n\t\tanimate,\r\n\t\tstop\r\n\t};\r\n}\r\n\r\n\r\nfunction getAutoScrollInfo(pos, elementSize, scrollableBeginEnd) {\r\n\tconst { begin, end } = scrollableBeginEnd;\r\n\tconst moveDistance = 100;\r\n\tif (end - pos < moveDistance) {\r\n\t\treturn {\r\n\t\t\tdirection: 'end',\r\n\t\t\tspeedFactor: (moveDistance - (end - pos)) / moveDistance\r\n\t\t};\r\n\t} else if (pos - begin < moveDistance) {\r\n\t\t// console.log(pos - begin);\r\n\t\treturn {\r\n\t\t\tdirection: 'begin',\r\n\t\t\tspeedFactor: (moveDistance - (pos - begin)) / moveDistance\r\n\t\t};\r\n\t}\r\n}\r\n\r\n\r\nexport default ({ element, layout, options }) => {\r\n\tlet lastPos = null;\r\n\tconst axis = options.orientation === 'vertical' ? 'Y' : 'X';\r\n\tlet scrollableParent = getScrollableParent(element, axis);\r\n\tconst scrollParentBeginEnd = scrollableParent ? layout.getBeginEndOfDOMRect(scrollableParent.getBoundingClientRect()) : null;\r\n\tlet animator = requestFrame(element, layout);\r\n\treturn ({ draggableInfo, dragResult, reset }) => {\r\n\t\tif (options.autoScrollEnabled && scrollableParent) {\r\n\t\t\tif (reset) {\r\n\t\t\t\tanimator.stop();\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\tif (dragResult.pos !== null) {\r\n\t\t\t\tif (lastPos === null) {\r\n\t\t\t\t\tscrollableParent = getScrollableParent(element, axis);\r\n\t\t\t\t\tanimator.stop();\r\n\t\t\t\t\tanimator = requestFrame(scrollableParent, layout);\r\n\t\t\t\t}\r\n\t\t\t\tconst autoScrollInfo = getAutoScrollInfo(dragResult.pos, dragResult.elementSize, scrollParentBeginEnd);\r\n\t\t\t\tif (autoScrollInfo) {\r\n\t\t\t\t\tanimator.animate(autoScrollInfo.direction, autoScrollInfo.speedFactor * maxSpeed);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tanimator.stop();\r\n\t\t\t\t}\r\n\t\t\t\tlastPos = dragResult.pos;\r\n\t\t\t} else {\r\n\t\t\t\tanimator.stop();\r\n\t\t\t}\r\n\r\n\t\t\tlastPos = dragResult.pos;\r\n\t\t}\r\n\t\treturn null;\r\n\t};\r\n};","import { hasClass, addClass, removeClass, getParent } from './utils';\r\nimport { domDropHandler } from './dropHandlers';\r\nimport dragscroller from './dragscroller';\r\nimport {\r\n\tdefaultGroupName,\r\n\twrapperClass,\r\n\tanimationClass,\r\n\tstretcherElementClass,\r\n\tstretcherElementInstance,\r\n\ttranslationValue,\r\n\tcontainerClass,\r\n\tcontainerInstance,\r\n\tcontainersInDraggable\r\n} from './constants';\r\nimport layoutManager from './layoutManager';\r\nimport Mediator from './mediator';\r\n// import './container.css';\r\n\r\nconst defaultOptions = {\r\n\tgroupName: null,\r\n\tbehaviour: 'move', // move | copy\r\n\tacceptGroups: [defaultGroupName],\r\n\torientation: 'vertical', // vertical | horizontal\r\n\tgetChildPayload: () => { return undefined; },\r\n\tanimationDuration: 180,\r\n\tautoScrollEnabled: true,\r\n\tshouldAcceptDrop: null,\r\n\tshouldAnimateDrop: null\r\n};\r\n\r\nfunction setAnimation(element, add, animationDuration) {\r\n\tif (add) {\r\n\t\taddClass(element, animationClass);\r\n\t\telement.style.transitionDuration = animationDuration + 'ms';\r\n\t} else {\r\n\t\tremoveClass(element, animationClass);\r\n\t\telement.style.transitionDuration = null;\r\n\t}\r\n}\r\n\r\nfunction getContainer(element) {\r\n\treturn element ? element[containerInstance] : null;\r\n}\r\n\r\nfunction initOptions(props = defaultOptions) {\r\n\tconst result = Object.assign({}, defaultOptions, props);\r\n\tif (result.groupName && !props.acceptGroups) {\r\n\t\tresult.acceptGroups = [props.groupName];\r\n\t}\r\n\treturn result;\r\n}\r\n\r\nfunction isDragRelevant({ element, options }) {\r\n\treturn function(sourceContainer, payload) {\r\n\t\tif (options.shouldAcceptDrop) {\r\n\t\t\treturn options.shouldAcceptDrop(sourceContainer.getOptions(), payload)\r\n\t\t}\r\n\t\tconst sourceOptions = sourceContainer.getOptions();\r\n\t\tif (options.behaviour === 'copy') return false;\r\n\r\n\t\tconst parentWrapper = getParent(element, '.' + wrapperClass);\r\n\t\tif (parentWrapper === sourceContainer.element) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (sourceContainer.element === element) return true;\r\n\t\tif (sourceOptions.groupName && sourceOptions.groupName === options.groupName) return true;\r\n\t\tif (options.acceptGroups.indexOf(sourceOptions.groupName) > -1) return true;\r\n\r\n\t\treturn false;\r\n\t};\r\n}\r\n\r\nfunction wrapChild(child, orientation) {\r\n\tconst div = document.createElement('div');\r\n\tdiv.className = `${wrapperClass} ${orientation} ${animationClass}`;\r\n\tchild.parentElement.insertBefore(div, child);\r\n\tdiv.appendChild(child);\r\n\treturn div;\r\n}\r\n\r\nfunction wrapChildren(element, orientation, animationDuration) {\r\n\tconst draggables = Array.prototype.map.call(element.children, child => {\r\n\t\tlet wrapper = child;\r\n\t\tif (!hasClass(child, wrapperClass)) {\r\n\t\t\twrapper = wrapChild(child, orientation, animationDuration);\r\n\t\t}\t\t\r\n\t\twrapper[containersInDraggable] = [];\r\n\t\twrapper[translationValue] = 0;\r\n\t\treturn wrapper;\r\n\t});\r\n\treturn draggables;\r\n}\r\n\r\nfunction findDraggebleAtPos({ layout }) {\r\n\tconst find = (draggables, pos, startIndex, endIndex, withRespectToMiddlePoints = false) => {\r\n\t\tif (endIndex < startIndex) {\r\n\t\t\treturn startIndex;\r\n\t\t}\r\n\t\t// binary serach draggable\r\n\t\tif (startIndex === endIndex) {\r\n\t\t\tlet { begin, end } = layout.getBeginEnd(draggables[startIndex]);\r\n\t\t\t// mouse pos is inside draggable\r\n\t\t\t// now decide which index to return\r\n\t\t\tif (pos > begin && pos <= end) {\r\n\t\t\t\tif (withRespectToMiddlePoints) {\r\n\t\t\t\t\treturn (pos < ((end + begin) / 2)) ? startIndex : startIndex + 1;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn startIndex;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconst middleIndex = Math.floor((endIndex + startIndex) / 2);\r\n\t\t\tconst { begin, end } = layout.getBeginEnd(draggables[middleIndex]);\r\n\t\t\tif (pos < begin) {\r\n\t\t\t\treturn find(draggables, pos, startIndex, middleIndex - 1, withRespectToMiddlePoints);\r\n\t\t\t} else if (pos > end) {\r\n\t\t\t\treturn find(draggables, pos, middleIndex + 1, endIndex, withRespectToMiddlePoints);\r\n\t\t\t} else {\r\n\t\t\t\tif (withRespectToMiddlePoints) {\r\n\t\t\t\t\treturn (pos < ((end + begin) / 2)) ? middleIndex : middleIndex + 1;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn middleIndex;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\treturn (draggables, pos, withRespectToMiddlePoints = false) => {\r\n\t\treturn find(draggables, pos, 0, draggables.length - 1, withRespectToMiddlePoints);\r\n\t};\r\n}\r\n\r\nfunction resetDraggables({ element, draggables, layout, options }) {\r\n\treturn function() {\r\n\t\tdraggables.forEach(p => {\r\n\t\t\tsetAnimation(p, false);\r\n\t\t\tlayout.setTranslation(p, 0);\r\n\t\t\tlayout.setVisibility(p, true);\r\n\t\t\tp[containersInDraggable] = [];\r\n\t\t});\r\n\r\n\t\tif (element[stretcherElementInstance]) {\r\n\t\t\telement[stretcherElementInstance].parentNode.removeChild(element[stretcherElementInstance]);\r\n\t\t\telement[stretcherElementInstance] = null;\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction setTargetContainer(draggableInfo, element, set = true) {\r\n\tif (element && set) {\r\n\t\tdraggableInfo.targetElement = element;\r\n\t} else {\r\n\t\tif (draggableInfo.targetElement === element) {\r\n\t\t\tdraggableInfo.targetElement = null;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction handleDrop({ element, draggables, layout, options }) {\r\n\tconst draggablesReset = resetDraggables({ element, draggables, layout, options });\r\n\tconst dropHandler = (options.dropHandler || domDropHandler)(({ element, draggables, layout, options }));\r\n\treturn function(draggableInfo, { addedIndex, removedIndex }) {\r\n\t\tdraggablesReset();\r\n\t\t// if drop zone is valid => complete drag else do nothing everything will be reverted by draggablesReset()\r\n\t\tif (draggableInfo.targetElement) {\r\n\t\t\tlet actualAddIndex = addedIndex !== null ? ((removedIndex !== null && removedIndex < addedIndex) ? addedIndex - 1 : addedIndex) : null;\r\n\t\t\tconst dropHandlerParams = {\r\n\t\t\t\tremovedIndex,\r\n\t\t\t\taddedIndex: actualAddIndex,\r\n\t\t\t\tpayload: draggableInfo.payload,\r\n\t\t\t\tdroppedElement: draggableInfo.element.firstChild\r\n\t\t\t};\r\n\t\t\tdropHandler(dropHandlerParams, options.onDrop);\r\n\t\t\tconsole.log(removedIndex, actualAddIndex, draggableInfo.payload, draggableInfo.element.firstChild);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction getContainerProps(element, initialOptions) {\r\n\tconst options = initOptions(initialOptions);\r\n\tconst draggables = wrapChildren(element, options.orientation, options.animationDuration);\r\n\t// set flex classes before layout is inited for scroll listener\r\n\taddClass(element, `${containerClass} ${options.orientation}`);\r\n\tconst layout = layoutManager(element, options.orientation, options.animationDuration);\r\n\treturn {\r\n\t\telement,\r\n\t\tdraggables,\r\n\t\toptions,\r\n\t\tlayout\r\n\t};\r\n}\r\n\r\nfunction getRelaventParentContainer(container, relevantContainers) {\r\n\tlet current = container.element;\r\n\twhile (current) {\r\n\t\tconst containerOfParentElement = getContainer(current.parentElement);\r\n\t\tif (containerOfParentElement && relevantContainers.indexOf(containerOfParentElement) > -1) {\r\n\t\t\treturn {\r\n\t\t\t\tcontainer: containerOfParentElement,\r\n\t\t\t\tdraggable: current\r\n\t\t\t};\r\n\t\t}\r\n\t\tcurrent = current.parentElement;\r\n\t}\r\n\r\n\treturn null;\r\n}\r\n\r\nfunction registerToParentContainer(container, relevantContainers) {\r\n\tconst parentInfo = getRelaventParentContainer(container, relevantContainers);\r\n\tif (parentInfo) {\r\n\t\tparentInfo.container.getChildContainers().push(container);\r\n\t\tcontainer.setParentContainer(parentInfo.container);\r\n\t\t//current should be draggable\r\n\t\tparentInfo.draggable[containersInDraggable].push(container);\r\n\t}\r\n}\r\n\r\nfunction getRemovedItem({ draggables, element, options }) {\r\n\tlet prevRemovedIndex = null;\r\n\treturn ({ draggableInfo, dragResult }) => {\r\n\t\tlet removedIndex = prevRemovedIndex;\r\n\t\tif (prevRemovedIndex == null && draggableInfo.container.element === element && options.behaviour === 'move') {\r\n\t\t\tremovedIndex = prevRemovedIndex = draggableInfo.elementIndex;\r\n\t\t}\r\n\r\n\t\treturn { removedIndex };\r\n\t};\r\n}\r\n\r\nfunction setRemovedItemVisibilty({ draggables, layout }) {\r\n\treturn ({ draggableInfo, dragResult }) => {\r\n\t\tif (dragResult.removedIndex !== null) {\r\n\t\t\tlayout.setVisibility(draggables[dragResult.removedIndex], false);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction getPosition({ element, layout }) {\r\n\treturn ({ draggableInfo }) => {\r\n\t\treturn {\r\n\t\t\tpos: !getContainer(element).isPosInChildContainer() ? layout.getPosition(draggableInfo.position) : null\r\n\t\t};\r\n\t};\r\n}\r\n\r\nfunction notifyParentOnPositionCapture({ element }) {\r\n\tlet isCaptured = false;\r\n\treturn ({ draggableInfo, dragResult }) => {\r\n\t\tif (getContainer(element).getParentContainer() && isCaptured !== (dragResult.pos !== null)) {\r\n\t\t\tisCaptured = dragResult.pos !== null;\r\n\t\t\tgetContainer(element).getParentContainer().onChildPositionCaptured(isCaptured);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction getElementSize({ layout }) {\r\n\tlet elementSize = null;\r\n\treturn ({ draggableInfo, dragResult }) => {\r\n\t\tif (dragResult.pos === null) {\r\n\t\t\treturn elementSize = null;\r\n\t\t} else {\r\n\t\t\telementSize = elementSize || layout.getSize(draggableInfo.element);\r\n\t\t}\r\n\t\treturn { elementSize };\r\n\t};\r\n}\r\n\r\nfunction handleTargetContainer({ element }) {\r\n\treturn ({ draggableInfo, dragResult }) => {\r\n\t\tsetTargetContainer(draggableInfo, element, !!dragResult.pos);\r\n\t};\r\n}\r\n\r\nfunction getDragInsertionIndex({ draggables, layout }) {\r\n\tconst findDraggable = findDraggebleAtPos({ layout });\r\n\treturn ({ dragResult: { shadowBeginEnd, pos } }) => {\r\n\t\tif (!shadowBeginEnd) {\r\n\t\t\tconst index = findDraggable(draggables, pos, true);\r\n\t\t\treturn index !== null ? index : draggables.length;\r\n\t\t} else {\r\n\t\t\tif (shadowBeginEnd.begin + shadowBeginEnd.beginAdjustment <= pos && shadowBeginEnd.end >= pos) {\r\n\t\t\t\t// position inside ghost\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (pos < shadowBeginEnd.begin + shadowBeginEnd.beginAdjustment) {\r\n\t\t\treturn findDraggable(draggables, pos);\r\n\t\t} else if (pos > shadowBeginEnd.end) {\r\n\t\t\treturn findDraggable(draggables, pos) + 1;\r\n\t\t} else {\r\n\t\t\treturn draggables.length;\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction invalidateShadowBeginEndIfNeeded(params) {\r\n\tconst shadowBoundsGetter = getShadowBeginEnd(params);\r\n\treturn ({ draggableInfo, dragResult }) => {\r\n\t\tif (draggableInfo.invalidateShadow) {\r\n\t\t\treturn shadowBoundsGetter({ draggableInfo, dragResult });\r\n\t\t}\r\n\t\treturn null;\r\n\t};\r\n}\r\n\r\nfunction getNextAddedIndex(params) {\r\n\tconst getIndexForPos = getDragInsertionIndex(params);\r\n\treturn ({ dragResult }) => {\r\n\t\tlet index = null;\r\n\t\tif (dragResult.pos !== null) {\r\n\t\t\tindex = getIndexForPos({ dragResult });\r\n\t\t\tif (index === null) {\r\n\t\t\t\tindex = dragResult.addedIndex;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn {\r\n\t\t\taddedIndex: index\r\n\t\t};\r\n\t};\r\n}\r\n\r\nfunction resetShadowAdjustment() {\r\n\tlet lastAddedIndex = null;\r\n\treturn ({ dragResult: { addedIndex, shadowBeginEnd } }) => {\r\n\t\tif (addedIndex !== lastAddedIndex && lastAddedIndex !== null && shadowBeginEnd) {\r\n\t\t\tshadowBeginEnd.beginAdjustment = 0;\r\n\t\t}\r\n\t\tlastAddedIndex = addedIndex;\r\n\t};\r\n}\r\n\r\nfunction handleInsertionSizeChange({ element, draggables, layout, options }) {\r\n\tlet strectherElement = null;\r\n\tlet stretcherElementAdded = false;\r\n\r\n\treturn function({ dragResult: { addedIndex, removedIndex, elementSize } }) {\r\n\t\tif (removedIndex === null) {\r\n\t\t\tif (addedIndex !== null) {\r\n\t\t\t\tif (!stretcherElementAdded) {\r\n\t\t\t\t\tconst containerBeginEnd = layout.getBeginEndOfContainer();\r\n\t\t\t\t\tconst hasScrollBar = layout.getScrollSize(element) > layout.getSize(element);\r\n\t\t\t\t\tconst containerEnd = hasScrollBar ? (containerBeginEnd.begin + layout.getScrollSize(element) - layout.getScrollValue(element)) : containerBeginEnd.end;\r\n\t\t\t\t\tconst lastDraggableEnd = layout.getBeginEnd(draggables[draggables.length - 1]).end - draggables[draggables.length - 1][translationValue];\r\n\t\t\t\t\tif (lastDraggableEnd + elementSize > containerEnd) {\r\n\t\t\t\t\t\tstrectherElement = document.createElement('div');\r\n\t\t\t\t\t\tstrectherElement.className = stretcherElementClass + ' ' + options.orientation;\r\n\t\t\t\t\t\tconst stretcherSize = (elementSize + lastDraggableEnd) - containerEnd;\r\n\t\t\t\t\t\tlayout.setSize(strectherElement.style, `${stretcherSize}px`);\r\n\t\t\t\t\t\telement.appendChild(strectherElement);\r\n\t\t\t\t\t\telement[stretcherElementInstance] = strectherElement;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tstretcherElementAdded = true;\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tlayout.invalidateRects();\r\n\t\t\t\t\t}, 100);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (strectherElement) {\r\n\t\t\t\t\tlayout.setTranslation(strectherElement, 0);\r\n\t\t\t\t\tlet toRemove = strectherElement;\r\n\t\t\t\t\tstrectherElement = null;\r\n\t\t\t\t\telement.removeChild(toRemove);\r\n\t\t\t\t\telement[stretcherElementInstance] = null;\r\n\t\t\t\t}\r\n\t\t\t\tstretcherElementAdded = false;\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tlayout.invalidateRects();\r\n\t\t\t\t}, 100);\r\n\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction calculateTranslations({ element, draggables, layout }) {\r\n\tlet prevAddedIndex = null;\r\n\tlet prevRemovedIndex = null;\r\n\treturn function({ dragResult: { addedIndex, removedIndex, elementSize } }) {\r\n\t\tif (addedIndex !== prevAddedIndex || removedIndex !== prevRemovedIndex) {\r\n\t\t\tfor (let index = 0; index < draggables.length; index++) {\r\n\t\t\t\tif (index !== removedIndex) {\r\n\t\t\t\t\tconst draggable = draggables[index];\r\n\t\t\t\t\tlet translate = 0;\r\n\t\t\t\t\tif (removedIndex !== null && removedIndex < index) {\r\n\t\t\t\t\t\ttranslate -= layout.getSize(draggables[removedIndex]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (addedIndex !== null && addedIndex <= index) {\r\n\t\t\t\t\t\ttranslate += elementSize;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlayout.setTranslation(draggable, translate);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tprevAddedIndex = addedIndex;\r\n\t\t\tprevRemovedIndex = removedIndex;\r\n\r\n\t\t\treturn { addedIndex, removedIndex };\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction getShadowBeginEnd({ draggables, layout }) {\r\n\tlet prevAddedIndex = null;\r\n\treturn ({ draggableInfo, dragResult }) => {\r\n\t\tconst { addedIndex, removedIndex, elementSize, pos, shadowBeginEnd } = dragResult;\r\n\t\tif (pos !== null) {\r\n\t\t\tif (addedIndex !== null && (draggableInfo.invalidateShadow || addedIndex !== prevAddedIndex)) {\r\n\t\t\t\tif (prevAddedIndex)\r\n\t\t\t\t\tprevAddedIndex = addedIndex;\r\n\t\t\t\tlet beforeIndex = addedIndex - 1;\r\n\t\t\t\tlet begin = 0;\r\n\t\t\t\tlet afterBounds = null;\r\n\t\t\t\tlet beforeBounds = null;\r\n\t\t\t\tif (beforeIndex === removedIndex) {\r\n\t\t\t\t\tbeforeIndex--;\r\n\t\t\t\t}\r\n\t\t\t\tif (beforeIndex > -1) {\r\n\t\t\t\t\tconst beforeSize = layout.getSize(draggables[beforeIndex]);\r\n\t\t\t\t\tbeforeBounds = layout.getBeginEnd(draggables[beforeIndex]);\r\n\t\t\t\t\tif (elementSize < beforeSize) {\r\n\t\t\t\t\t\tconst threshold = (beforeSize - elementSize) / 2;\r\n\t\t\t\t\t\tbegin = beforeBounds.end - threshold;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tbegin = beforeBounds.end;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tbeforeBounds = { end: layout.getBeginEndOfContainer().begin };\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet end = 10000;\r\n\t\t\t\tlet afterIndex = addedIndex;\r\n\t\t\t\tif (afterIndex === removedIndex) {\r\n\t\t\t\t\tafterIndex++;\r\n\t\t\t\t}\r\n\t\t\t\tif (afterIndex < draggables.length) {\r\n\t\t\t\t\tconst afterSize = layout.getSize(draggables[afterIndex]);\r\n\t\t\t\t\tafterBounds = layout.getBeginEnd(draggables[afterIndex]);\r\n\r\n\t\t\t\t\tif (elementSize < afterSize) {\r\n\t\t\t\t\t\tconst threshold = (afterSize - elementSize) / 2;\r\n\t\t\t\t\t\tend = afterBounds.begin + threshold;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tend = afterBounds.begin;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tafterBounds = { begin: layout.getContainerRectangles().end };\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst shadowRectTopLeft = beforeBounds && afterBounds ? layout.getTopLeftOfElementBegin(beforeBounds.end, afterBounds.begin) : null;\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tshadowBeginEnd: {\r\n\t\t\t\t\t\tbegin,\r\n\t\t\t\t\t\tend,\r\n\t\t\t\t\t\trect: shadowRectTopLeft,\r\n\t\t\t\t\t\tbeginAdjustment: shadowBeginEnd ? shadowBeginEnd.beginAdjustment : 0,\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tprevAddedIndex = null;\r\n\t\t\treturn {\r\n\t\t\t\tshadowBeginEnd: null\r\n\t\t\t};\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction handleFirstInsertShadowAdjustment() {\r\n\tlet lastAddedIndex = null;\r\n\treturn ({ dragResult: { pos, addedIndex, shadowBeginEnd }, draggableInfo: { invalidateShadow } }) => {\r\n\t\tif (pos !== null) {\r\n\t\t\tif (addedIndex != null && lastAddedIndex === null) {\r\n\t\t\t\tif (pos < shadowBeginEnd.begin) {\r\n\t\t\t\t\tconst beginAdjustment = pos - shadowBeginEnd.begin - 5;\r\n\t\t\t\t\tshadowBeginEnd.beginAdjustment = beginAdjustment;\r\n\t\t\t\t}\r\n\t\t\t\tlastAddedIndex = addedIndex;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tlastAddedIndex = null;\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction getDragHandler(params) {\r\n\treturn compose(params)(\r\n\t\tgetRemovedItem,\r\n\t\tsetRemovedItemVisibilty,\r\n\t\tgetPosition,\r\n\t\tnotifyParentOnPositionCapture,\r\n\t\tgetElementSize,\r\n\t\thandleTargetContainer,\r\n\t\tinvalidateShadowBeginEndIfNeeded,\r\n\t\tgetNextAddedIndex,\r\n\t\tresetShadowAdjustment,\r\n\t\thandleInsertionSizeChange,\r\n\t\tcalculateTranslations,\r\n\t\tgetShadowBeginEnd,\r\n\t\thandleFirstInsertShadowAdjustment\r\n\t);\r\n}\r\n\r\nfunction getDefaultDragResult() {\r\n\treturn {\r\n\t\taddedIndex: null,\r\n\t\tremovedIndex: null,\r\n\t\telementSize: null,\r\n\t\tpos: null,\r\n\t\tshadowBeginEnd: null\r\n\t};\r\n}\r\n\r\nfunction compose(params) {\r\n\treturn (...functions) => {\r\n\t\tconst hydratedFunctions = functions.map(p => p(params));\r\n\t\tlet result = null;\r\n\t\treturn (draggableInfo) => {\r\n\t\t\tresult = hydratedFunctions.reduce((dragResult, fn) => {\r\n\t\t\t\treturn Object.assign(dragResult, fn({ draggableInfo, dragResult }));\r\n\t\t\t}, result || getDefaultDragResult());\r\n\t\t\treturn result;\r\n\t\t};\r\n\t};\r\n}\r\n\r\n// Container definition begin\r\nfunction Container(element) {\r\n\treturn function(options) {\r\n\t\tlet dragResult = null;\r\n\t\tlet lastDraggableInfo = null;\r\n\t\tconst props = getContainerProps(element, options);\r\n\t\tlet dragHandler = getDragHandler(props);\r\n\t\tlet dropHandler = handleDrop(props);\r\n\t\tlet handleScrollOnDrag = dragscroller(props);\r\n\t\tlet parentContainer = null;\r\n\t\tlet posIsInChildContainer = false;\r\n\t\tlet childContainers = [];\r\n\r\n\t\tfunction processLastDraggableInfo() {\r\n\t\t\tif (lastDraggableInfo !== null) {\r\n\t\t\t\tlastDraggableInfo.invalidateShadow = true;\r\n\t\t\t\tdragResult = dragHandler(lastDraggableInfo);\r\n\t\t\t\tlastDraggableInfo.invalidateShadow = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction onChildPositionCaptured(isCaptured) {\r\n\t\t\tposIsInChildContainer = isCaptured;\r\n\t\t\tif (parentContainer) {\r\n\t\t\t\tparentContainer.onChildPositionCaptured(isCaptured);\r\n\t\t\t\tif (lastDraggableInfo) {\r\n\t\t\t\t\tdragResult = dragHandler(lastDraggableInfo);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction shouldAnimateDrop() {\r\n\t\t\treturn props.options.shouldAnimateDrop ? props.options.shouldAnimateDrop({\r\n\t\t\t\tsourceContainerProps: lastDraggableInfo.container.getOptions(),\r\n\t\t\t\tpayload: lastDraggableInfo.payload\r\n\t\t\t}) : true;\r\n\t\t}\r\n\r\n\t\tfunction shouldAcceptDrop() {\r\n\t\t\treturn \r\n\t\t}\r\n\r\n\t\tfunction setDraggables(draggables, element, options) {\r\n\t\t\tconst newDraggables = wrapChildren(element, options.orientation, options.animationDuration);\r\n\t\t\tfor (let i = 0; i < newDraggables.length; i++) {\r\n\t\t\t\tdraggables[i] = newDraggables[i];\r\n\t\t\t}\r\n\r\n\t\t\tfor (let i = 0; i < draggables.length - newDraggables.length; i++) {\r\n\t\t\t\tdraggables.pop();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction prepareDrag(container, relevantContainers) {\r\n\t\t\tconst element = container.element;\r\n\t\t\tconst draggables = props.draggables;\r\n\t\t\tconst options = container.getOptions();\r\n\t\t\tsetDraggables(draggables, element, options);\r\n\t\t\tcontainer.layout.invalidateRects();\r\n\t\t\tregisterToParentContainer(container, relevantContainers);\r\n\t\t\tdraggables.forEach(p => setAnimation(p, true, options.animationDuration));\r\n\t\t}\r\n\r\n\t\tprops.layout.setScrollListener(function() {\r\n\t\t\tprocessLastDraggableInfo();\r\n\t\t});\r\n\r\n\t\tfunction dispose(container) {\r\n\t\t\t// additional dispose actions\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\telement,\r\n\t\t\tdraggables: props.draggables,\r\n\t\t\tisDragRelevant: isDragRelevant(props),\r\n\t\t\tgetScale: props.layout.getContainerScale,\r\n\t\t\tgetChildPayload: props.options.getChildPayload,\r\n\t\t\tgroupName: props.options.groupName,\r\n\t\t\tlayout: props.layout,\r\n\t\t\tgetChildContainers: () => childContainers,\r\n\t\t\tonChildPositionCaptured,\r\n\t\t\tdispose,\r\n\t\t\tprepareDrag,\r\n\t\t\tisPosInChildContainer: () => posIsInChildContainer,\r\n\t\t\thandleDrag: function(draggableInfo) {\r\n\t\t\t\tlastDraggableInfo = draggableInfo;\r\n\t\t\t\tdragResult = dragHandler(draggableInfo);\r\n\t\t\t\t// console.log(dragResult);\r\n\t\t\t\thandleScrollOnDrag({ draggableInfo, dragResult });\r\n\t\t\t},\r\n\t\t\thandleDrop: function(draggableInfo) {\r\n\t\t\t\tlastDraggableInfo = null;\r\n\t\t\t\tonChildPositionCaptured(false);\r\n\t\t\t\tdragHandler = getDragHandler(props);\r\n\t\t\t\tdropHandler(draggableInfo, dragResult);\r\n\t\t\t\thandleScrollOnDrag({ reset: true });\r\n\t\t\t\thandleScrollOnDrag = dragscroller(props);\r\n\t\t\t\tparentContainer = null;\r\n\t\t\t\tchildContainers = [];\r\n\t\t\t},\r\n\t\t\tgetDragResult: function() {\r\n\t\t\t\treturn dragResult;\r\n\t\t\t},\r\n\t\t\tgetTranslateCalculator: function(...params) {\r\n\t\t\t\treturn calculateTranslations(props)(...params);\r\n\t\t\t},\r\n\t\t\tsetParentContainer: (e) => { parentContainer = e; },\r\n\t\t\tgetParentContainer: () => parentContainer,\r\n\t\t\tonTranslated: () => {\r\n\t\t\t\tprocessLastDraggableInfo();\r\n\t\t\t},\r\n\t\t\tgetOptions: () => props.options,\r\n\t\t\tshouldAnimateDrop,\r\n\t\t\tsetDraggables: () => {\r\n\t\t\t\tsetDraggables(props.draggables, element, props.options);\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n}\r\n\r\nconst options = {\r\n\tonDragStart: (itemIndex) => { },\r\n\tonDragMove: () => { },\r\n\tonDrop: () => { },\r\n\tbehaviour: 'move',\r\n\tgroupName: 'bla bla', // if not defined => container will not interfere with other containers\r\n\tacceptGroups: [],\r\n\torientation: 'vertical',\r\n\tdragHandleSelector: null,\r\n\tnonDragAreaSelector: 'some selector',\r\n\tdragBeginDelay: 0,\r\n\tanimationDuration: 180,\r\n\tautoScrollEnabled: true,\r\n\tgetChildPayload: (index) => null,\r\n\tshouldAnimateDrop: (params) => true\r\n};\r\n\r\n// exported part of container\r\nexport default function(element, options) {\r\n\tconst containerIniter = Container(element);\r\n\tconst container = containerIniter(options);\r\n\telement[containerInstance] = container;\r\n\tMediator.register(container);\r\n\treturn {\r\n\t\tsetOptions: containerIniter,\r\n\t\tdispose: function() {\r\n\t\t\tMediator.unregister(container);\r\n\t\t\tcontainer.layout.dispose();\r\n\t\t\tcontainer.dispose(container);\r\n\t\t}\r\n\t};\r\n}\r\n","import container from './src/container';\r\nimport * as constants from './src/constants';\r\nimport * as dropHandlers from './src/dropHandlers';\r\nexport default container;\r\nexport {\r\n\tconstants,\r\n\tdropHandlers\r\n};"],"sourceRoot":""}